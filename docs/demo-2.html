<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-10-27 Mon 21:43 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>lispy.el demo 2: the substitution model for procedure application</title>
<meta name="author" content="Ahmed Khanzada" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="demo-style.css"/>
</head>
<body>
<div id="preamble" class="status">
<link rel="icon" type="image/x-icon" href="https://github.com/favicon.ico"/>
</div>
<div id="content" class="content">
<h1 class="title">lispy.el demo 2: the substitution model for procedure application</h1>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://github.com/abo-abo/lispy">Back to github</a></td>
<td class="org-left"><a href="https://raw.githubusercontent.com/abo-abo/lispy/gh-pages/demo-2.org">This file in org-mode</a></td>
<td class="org-left"><a href="http://abo-abo.github.io/lispy/">Function reference</a></td>
</tr>
</tbody>
</table>
<div id="outline-container-orgae3a89b" class="outline-2">
<h2 id="orgae3a89b">Intro</h2>
<div class="outline-text-2" id="text-orgae3a89b">
<p>
Comes from <a href="http://emacs.stackexchange.com/questions/3203/how-to-understand-this-recursion-code">this emacs.stackexchange question</a>.
</p>
</div>
</div>
<div id="outline-container-orgdbd7352" class="outline-2">
<h2 id="orgdbd7352">Task summary</h2>
<div class="outline-text-2" id="text-orgdbd7352">
<p>
Understand how this code works:
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><code><span style="color: #e7dbc0;">(</span><span style="color: #a1b9e1;">defun</span><span style="color: #a1b9e1;"> </span><span style="color: #a1b9e1;">triangle-using-cond</span><span style="color: #a1b9e1;"> (</span><span style="color: #ccb9e3;">number</span><span style="color: #a1b9e1;">)</span>
  <span style="color: #a1b9e1;">(</span><span style="color: #ccb9e3;">cond</span><span style="color: #ccb9e3;"> (</span><span style="color: #797979;">(</span><span style="color: #e7dbc0;">&lt;= number 0</span><span style="color: #797979;">)</span> <span style="color: #797979;">0</span><span style="color: #ccb9e3;">)</span>
        <span style="color: #ccb9e3;">(</span><span style="color: #797979;">(</span><span style="color: #e7dbc0;">= number 1</span><span style="color: #797979;">)</span> <span style="color: #797979;">1</span><span style="color: #ccb9e3;">)</span>
        <span style="color: #ccb9e3;">(</span><span style="color: #797979;">(</span><span style="color: #e7dbc0;">&gt; number 1</span><span style="color: #797979;">)</span>
         <span style="color: #797979;">(</span><span style="color: #e7dbc0;">+ number (</span><span style="color: #a1b9e1;">triangle-using-cond (</span><span style="color: #ccb9e3;">1- number</span><span style="color: #a1b9e1;">)</span><span style="color: #e7dbc0;">)</span><span style="color: #797979;">)</span><span style="color: #ccb9e3;">)</span><span style="color: #a1b9e1;">)</span><span style="color: #e7dbc0;">)</span>
</code></pre>
</div>
<p>
I'll use <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-10.html#%25_sec_1.1.5">The Substitution Model for Procedure Application</a> from SICP.
</p>
</div>
</div>
<div id="outline-container-org3eec66e" class="outline-2">
<h2 id="org3eec66e">Screencast</h2>
<div class="outline-text-2" id="text-org3eec66e">
<p>
The screencast for this demo is here: <a href="https://www.youtube.com/watch?v=D7mK2q3yve4">https://www.youtube.com/watch?v=D7mK2q3yve4</a>
</p>
</div>
</div>
<div id="outline-container-org906ffd3" class="outline-2">
<h2 id="org906ffd3">Step-by-step expansion</h2>
<div class="outline-text-2" id="text-org906ffd3">
</div>
<div id="outline-container-orge29a0b7" class="outline-3">
<h3 id="orge29a0b7">step 1</h3>
<div class="outline-text-3" id="text-orge29a0b7">
<p>
Start with this code:
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><code><span style="color: #e7dbc0;"><cursor>(</cursor></span><span style="color: #a1b9e1;">defun</span><span style="color: #a1b9e1;"> </span><span style="color: #a1b9e1;">triangle-using-cond</span><span style="color: #a1b9e1;"> (</span><span style="color: #ccb9e3;">number</span><span style="color: #a1b9e1;">)</span>
  <span style="color: #a1b9e1;">(</span><span style="color: #ccb9e3;">cond</span><span style="color: #ccb9e3;"> (</span><span style="color: #797979;">(</span><span style="color: #e7dbc0;">&lt;= number 0</span><span style="color: #797979;">)</span> <span style="color: #797979;">0</span><span style="color: #ccb9e3;">)</span>
        <span style="color: #ccb9e3;">(</span><span style="color: #797979;">(</span><span style="color: #e7dbc0;">= number 1</span><span style="color: #797979;">)</span> <span style="color: #797979;">1</span><span style="color: #ccb9e3;">)</span>
        <span style="color: #ccb9e3;">(</span><span style="color: #797979;">(</span><span style="color: #e7dbc0;">&gt; number 1</span><span style="color: #797979;">)</span>
         <span style="color: #797979;">(</span><span style="color: #e7dbc0;">+ number (</span><span style="color: #a1b9e1;">triangle-using-cond (</span><span style="color: #ccb9e3;">1- number</span><span style="color: #a1b9e1;">)</span><span style="color: #e7dbc0;">)</span><span style="color: #797979;">)</span><span style="color: #ccb9e3;">)</span><span style="color: #a1b9e1;">)</span><span style="color: #e7dbc0;">)</span>
<span style="color: #e7dbc0;">(</span><span style="color: #a1b9e1;">triangle-using-cond 4</span><span style="color: #e7dbc0;">)</span>
</code></pre>
</div>

<p>
Eval the defun with <kbd>e</kbd>. Then do <kbd>je</kbd> to eval the next expression to
get <code>10</code>.
</p>
</div>
</div>
<div id="outline-container-org57933bb" class="outline-3">
<h3 id="org57933bb">step 2</h3>
<div class="outline-text-3" id="text-org57933bb">
<p>
Press <kbd>xfM</kbd> to get:
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><code><span style="color: #e7dbc0;"><cursor>(</cursor></span><span style="color: #a1b9e1;">cond</span><span style="color: #a1b9e1;"> (</span><span style="color: #ccb9e3;">(</span><span style="color: #797979;">&lt;= 4 0</span><span style="color: #ccb9e3;">)</span>
       <span style="color: #ccb9e3;">0</span><span style="color: #a1b9e1;">)</span>
      <span style="color: #a1b9e1;">(</span><span style="color: #ccb9e3;">(</span><span style="color: #797979;">= 4 1</span><span style="color: #ccb9e3;">)</span>
       <span style="color: #ccb9e3;">1</span><span style="color: #a1b9e1;">)</span>
      <span style="color: #a1b9e1;">(</span><span style="color: #ccb9e3;">(</span><span style="color: #797979;">&gt; 4 1</span><span style="color: #ccb9e3;">)</span>
       <span style="color: #ccb9e3;">(</span><span style="color: #797979;">+ 4 (</span><span style="color: #e7dbc0;">triangle-using-cond (</span><span style="color: #a1b9e1;">1- 4</span><span style="color: #e7dbc0;">)</span><span style="color: #797979;">)</span><span style="color: #ccb9e3;">)</span><span style="color: #a1b9e1;">)</span><span style="color: #e7dbc0;">)</span>
</code></pre>
</div>
<p>
With <kbd>e</kbd> check that the result is still <code>10</code>.
</p>
</div>
</div>
<div id="outline-container-org87c5510" class="outline-3">
<h3 id="org87c5510">step 3</h3>
<div class="outline-text-3" id="text-org87c5510">
<p>
Evaluate the <code>cond</code> branches in your mind and simplify with <kbd>qhrr</kbd>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><code><span style="color: #e7dbc0;"><cursor>(</cursor></span><span style="color: #a1b9e1;">+ 4 (</span><span style="color: #ccb9e3;">triangle-using-cond (</span><span style="color: #797979;">1- 4</span><span style="color: #ccb9e3;">)</span><span style="color: #a1b9e1;">)</span><span style="color: #e7dbc0;">)</span>
</code></pre>
</div>
<p>
Then <kbd>ffxr</kbd>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><code><span style="color: #e7dbc0;">(</span><span style="color: #a1b9e1;">+ 4 <cursor>(</cursor></span><span style="color: #ccb9e3;">triangle-using-cond 3</span><span style="color: #a1b9e1;">)</span><span style="color: #e7dbc0;">)</span>
</code></pre>
</div>
</div>
</div>
<div id="outline-container-org93e0c23" class="outline-3">
<h3 id="org93e0c23">step 4</h3>
<div class="outline-text-3" id="text-org93e0c23">
<p>
Press <kbd>xfM</kbd> again:
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><code><span style="color: #e7dbc0;">(</span><span style="color: #a1b9e1;">+ 4 <cursor>(</cursor></span><span style="color: #ccb9e3;">cond</span><span style="color: #ccb9e3;"> (</span><span style="color: #797979;">(</span><span style="color: #e7dbc0;">&lt;= 3 0</span><span style="color: #797979;">)</span>
              <span style="color: #797979;">0</span><span style="color: #ccb9e3;">)</span>
             <span style="color: #ccb9e3;">(</span><span style="color: #797979;">(</span><span style="color: #e7dbc0;">= 3 1</span><span style="color: #797979;">)</span>
              <span style="color: #797979;">1</span><span style="color: #ccb9e3;">)</span>
             <span style="color: #ccb9e3;">(</span><span style="color: #797979;">(</span><span style="color: #e7dbc0;">&gt; 3 1</span><span style="color: #797979;">)</span>
              <span style="color: #797979;">(</span><span style="color: #e7dbc0;">+ 3 (</span><span style="color: #a1b9e1;">triangle-using-cond (</span><span style="color: #ccb9e3;">1- 3</span><span style="color: #a1b9e1;">)</span><span style="color: #e7dbc0;">)</span><span style="color: #797979;">)</span><span style="color: #ccb9e3;">)</span><span style="color: #a1b9e1;">)</span><span style="color: #e7dbc0;">)</span>
</code></pre>
</div>
<p>
Evaluate the <code>cond</code> branches in your mind and simplify with <kbd>qirr</kbd>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><code><span style="color: #e7dbc0;">(</span><span style="color: #a1b9e1;">+ 4 <cursor>(</cursor></span><span style="color: #ccb9e3;">+ 3 (</span><span style="color: #797979;">triangle-using-cond (</span><span style="color: #e7dbc0;">1- 3</span><span style="color: #797979;">)</span><span style="color: #ccb9e3;">)</span><span style="color: #a1b9e1;">)</span><span style="color: #e7dbc0;">)</span>
</code></pre>
</div>
<p>
Simplify further with <kbd>ffxr</kbd>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><code><span style="color: #e7dbc0;">(</span><span style="color: #a1b9e1;">+ 4 (</span><span style="color: #ccb9e3;">+ 3 <cursor>(</cursor></span><span style="color: #797979;">triangle-using-cond 2</span><span style="color: #ccb9e3;">)</span><span style="color: #a1b9e1;">)</span><span style="color: #e7dbc0;">)</span>
</code></pre>
</div>
</div>
</div>
<div id="outline-container-org50fbed0" class="outline-3">
<h3 id="org50fbed0">step 5</h3>
<div class="outline-text-3" id="text-org50fbed0">
<p>
Press <kbd>xfM</kbd> again:
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><code><span style="color: #e7dbc0;">(</span><span style="color: #a1b9e1;">+ 4 (</span><span style="color: #ccb9e3;">+ 3 <cursor>(</cursor></span><span style="color: #797979;">cond</span><span style="color: #797979;"> (</span><span style="color: #e7dbc0;">(</span><span style="color: #a1b9e1;">&lt;= 2 0</span><span style="color: #e7dbc0;">)</span>
                   <span style="color: #e7dbc0;">0</span><span style="color: #797979;">)</span>
                  <span style="color: #797979;">(</span><span style="color: #e7dbc0;">(</span><span style="color: #a1b9e1;">= 2 1</span><span style="color: #e7dbc0;">)</span>
                   <span style="color: #e7dbc0;">1</span><span style="color: #797979;">)</span>
                  <span style="color: #797979;">(</span><span style="color: #e7dbc0;">(</span><span style="color: #a1b9e1;">&gt; 2 1</span><span style="color: #e7dbc0;">)</span>
                   <span style="color: #e7dbc0;">(</span><span style="color: #a1b9e1;">+ 2 (</span><span style="color: #ccb9e3;">triangle-using-cond (</span><span style="color: #797979;">1- 2</span><span style="color: #ccb9e3;">)</span><span style="color: #a1b9e1;">)</span><span style="color: #e7dbc0;">)</span><span style="color: #797979;">)</span><span style="color: #ccb9e3;">)</span><span style="color: #a1b9e1;">)</span><span style="color: #e7dbc0;">)</span>
</code></pre>
</div>
<p>
Evaluate the <code>cond</code> branches in your mind and simplify with <kbd>qjrr</kbd>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><code><span style="color: #e7dbc0;">(</span><span style="color: #a1b9e1;">+ 4 (</span><span style="color: #ccb9e3;">+ 3 <cursor>(</cursor></span><span style="color: #797979;">+ 2 (</span><span style="color: #e7dbc0;">triangle-using-cond (</span><span style="color: #a1b9e1;">1- 2</span><span style="color: #e7dbc0;">)</span><span style="color: #797979;">)</span><span style="color: #ccb9e3;">)</span><span style="color: #a1b9e1;">)</span><span style="color: #e7dbc0;">)</span>
</code></pre>
</div>
<p>
Simplify further with <kbd>ffxr</kbd>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><code><span style="color: #e7dbc0;">(</span><span style="color: #a1b9e1;">+ 4 (</span><span style="color: #ccb9e3;">+ 3 (</span><span style="color: #797979;">+ 2 <cursor>(</cursor></span><span style="color: #e7dbc0;">triangle-using-cond 1</span><span style="color: #797979;">)</span><span style="color: #ccb9e3;">)</span><span style="color: #a1b9e1;">)</span><span style="color: #e7dbc0;">)</span>
</code></pre>
</div>
</div>
</div>
<div id="outline-container-orga8d76e9" class="outline-3">
<h3 id="orga8d76e9">step 6</h3>
<div class="outline-text-3" id="text-orga8d76e9">
<p>
Press <kbd>xfM</kbd> again:
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><code><span style="color: #e7dbc0;">(</span><span style="color: #a1b9e1;">+ 4 (</span><span style="color: #ccb9e3;">+ 3 (</span><span style="color: #797979;">+ 2 <cursor>(</cursor></span><span style="color: #e7dbc0;">cond</span><span style="color: #e7dbc0;"> (</span><span style="color: #a1b9e1;">(</span><span style="color: #ccb9e3;">&lt;= 1 0</span><span style="color: #a1b9e1;">)</span>
                        <span style="color: #a1b9e1;">0</span><span style="color: #e7dbc0;">)</span>
                       <span style="color: #e7dbc0;">(</span><span style="color: #a1b9e1;">(</span><span style="color: #ccb9e3;">= 1 1</span><span style="color: #a1b9e1;">)</span>
                        <span style="color: #a1b9e1;">1</span><span style="color: #e7dbc0;">)</span>
                       <span style="color: #e7dbc0;">(</span><span style="color: #a1b9e1;">(</span><span style="color: #ccb9e3;">&gt; 1 1</span><span style="color: #a1b9e1;">)</span>
                        <span style="color: #a1b9e1;">(</span><span style="color: #ccb9e3;">+ 1 (</span><span style="color: #797979;">triangle-using-cond (</span><span style="color: #eae3d2;">1- 1</span><span style="color: #797979;">)</span><span style="color: #ccb9e3;">)</span><span style="color: #a1b9e1;">)</span><span style="color: #e7dbc0;">)</span><span style="color: #797979;">)</span><span style="color: #ccb9e3;">)</span><span style="color: #a1b9e1;">)</span><span style="color: #e7dbc0;">)</span>
</code></pre>
</div>
<p>
Evaluate the <code>cond</code> branches in your mind and simplify with <kbd>akrr</kbd>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><code><span style="color: #e7dbc0;">(</span><span style="color: #a1b9e1;">+ 4 (</span><span style="color: #ccb9e3;">+ 3 (</span><span style="color: #797979;">+ 2 <cursor>1</cursor></span><span style="color: #ccb9e3;">)</span><span style="color: #a1b9e1;">)</span><span style="color: #e7dbc0;">)</span>
</code></pre>
</div>
<p>
<kbd>C-e</kbd> <kbd>e</kbd> to check that the result is still <code>10</code>. That's it.
</p>
</div>
</div>
</div>
</div>
</body>
</html>
